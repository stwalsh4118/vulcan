# [3-8] Real-Time Log Streaming

[Back to task list](./tasks.md)

## Description

Integrate real-time log streaming into the workload detail page using the EventSource API to consume the SSE `GET /v1/workloads/:id/logs` endpoint. Includes auto-scroll behavior and pause/resume controls.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 05:13:20 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-19 05:38:11 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-19 05:41:21 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-19 06:18:27 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. Connect to `GET /v1/workloads/:id/logs` SSE endpoint when workload status is `pending` or `running`.
2. Display received log lines in a scrollable, monospace-styled log viewer.
3. Auto-scroll to bottom as new lines arrive.
4. Pause/resume toggle: when paused, new lines still accumulate but auto-scroll stops. Resuming scrolls to latest.
5. Disconnect EventSource when workload reaches a terminal state or component unmounts.
6. Handle connection errors gracefully (show reconnection attempt or error message).
7. Show "No logs" or "Waiting for logs..." state when stream is empty.

## Implementation Plan

1. Create `web/src/components/logs/LogViewer.tsx` — log viewer component with auto-scroll.
2. Create `web/src/hooks/useLogStream.ts` — custom hook wrapping EventSource lifecycle.
   - Opens connection to SSE endpoint
   - Accumulates log lines in state
   - Closes on terminal status or unmount
   - Handles reconnection on error
3. Integrate `LogViewer` into the workload detail page (`/workloads/[id]`), replacing the placeholder from task 3-7.
4. Add pause/resume button toggling auto-scroll behavior.
5. Style log viewer: dark background, monospace font, green/white text, scrollable container with max height.

## Test Plan

### Objectives
Verify SSE log streaming works end-to-end from the browser.

### Test Scope
- EventSource connects to the correct endpoint.
- Log lines appear in the viewer as they arrive.
- Auto-scroll keeps the viewer at the bottom.
- Pause stops auto-scroll; resume catches up.
- Connection closes when workload finishes.
- Error state displays on connection failure.

### Success Criteria
- Logs stream in real time during workload execution.
- No memory leaks from unclosed EventSource connections.
- Pause/resume works correctly.

## Verification

- `pnpm build` succeeds with no errors.
- EventSource connects to correct SSE endpoint for active workloads.
- Log lines rendered in scrollable monospace viewer with green text on dark background.
- Auto-scroll keeps viewer at bottom; pause/resume toggle works.
- Connection closes on terminal status or component unmount.
- Reconnection logic: max 3 attempts with 2s delay, then error state.
- Status indicator: green=connected, yellow=connecting, red=error, gray=closed.
- Empty states: "Waiting for logs..." (connecting) and "No logs available." (closed).
- AI review: 0 critical, 0 high, 0 medium, 4 low (log truncation, error classification, sanitization, tests — all deferred).

## Files Modified

- `web/src/hooks/useLogStream.ts` — custom hook wrapping EventSource lifecycle
- `web/src/components/logs/LogViewer.tsx` — log viewer component with auto-scroll/pause
- `web/src/app/workloads/[id]/page.tsx` — integrated LogViewer, removed placeholder
