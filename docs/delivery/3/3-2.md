# [3-2] API Client Layer & TypeScript Types

[Back to task list](./tasks.md)

## Description

Create a typed API client that mirrors the Go backend's models and endpoints. This provides the data layer all pages will consume. Includes TypeScript types for Workload, WorkloadStats, BackendInfo, and related types, plus a fetch wrapper and React Query hooks for data fetching with polling.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 05:13:20 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-19 05:26:36 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-19 05:29:27 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-19 06:18:27 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. TypeScript types matching the Go API models:
   - `Workload` (all fields from `model.Workload`)
   - `WorkloadStats` (from `store.WorkloadStats`)
   - `BackendInfo` and `BackendCapabilities` (from `backend.Registry`)
   - Request/response types for create workload, list response envelope
   - Status and isolation/runtime constants as TypeScript enums or string unions
2. Typed fetch wrapper with:
   - Base URL configuration (uses Next.js API proxy by default)
   - JSON serialization/deserialization
   - Error handling (parse error responses, throw typed errors)
3. React Query hooks for data fetching:
   - `useWorkload(id)` — single workload with polling option
   - `useWorkloads(params)` — paginated list
   - `useStats()` — aggregate stats
   - `useBackends()` — available backends
4. API mutation functions:
   - `createWorkload(req)` — POST /v1/workloads/async
   - `deleteWorkload(id)` — DELETE /v1/workloads/:id

## Implementation Plan

1. Create `web/src/lib/types.ts` — all TypeScript types and constants.
2. Create `web/src/lib/api.ts` — fetch wrapper with error handling.
3. Create `web/src/lib/hooks.ts` — React Query hooks for each endpoint.
4. **External Packages**: This task requires research and a guide document for: `@tanstack/react-query`

## Test Plan

- TypeScript compilation passes with no type errors.
- Types match the Go API spec (manual cross-reference with `docs/api-specs/core/core-api.md`).
- React Query hooks are properly typed (verified by compilation).
- Fetch wrapper correctly constructs URLs and handles error responses (integration verified in page tasks).

## Verification

- `pnpm build` succeeds with no type errors.
- Types cross-referenced against `docs/api-specs/core/core-api.md` — all fields match.
- React Query hooks properly typed (verified by compilation).
- AI review: 0 critical, 0 high, 1 medium (URL params — numeric pagination doesn't need encoding), 4 low (deferred).

## Files Modified

- `web/src/lib/types.ts` — TypeScript types and constants
- `web/src/lib/api.ts` — fetch wrapper with error handling
- `web/src/lib/hooks.ts` — React Query hooks for all endpoints
- `web/src/lib/providers.tsx` — QueryClientProvider wrapper
- `web/src/app/layout.tsx` — integrated Providers
- `docs/delivery/3/3-2-react-query-guide.md` — external package research guide
