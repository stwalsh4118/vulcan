# [3-6] Workload Submission Form with Code Editor

[Back to task list](./tasks.md)

## Description

Build the workload submission form at `/workloads/new` with runtime/isolation selectors, an inline code editor with syntax highlighting, JSON input, resource limit controls, and submission to the API. This is the primary way users interact with Vulcan from the browser.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 05:13:20 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-19 05:34:12 | Status Change | Proposed | InProgress | Started implementation | AI_Agent |
| 2026-02-19 05:37:00 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-19 06:18:27 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. Route: `/workloads/new`.
2. Form fields:
   - **Runtime selector**: dropdown/select for `go`, `node`, `python`, `wasm`, `oci`.
   - **Isolation mode selector**: dropdown/select for `auto`, `microvm`, `isolate`, `gvisor`. Unavailable backends shown as disabled with tooltip (uses `GET /v1/backends` to determine availability).
   - **Code input**: inline code editor with syntax highlighting for JS/TS, Python, Go. Uses a code editor library (CodeMirror or Monaco).
   - **Input JSON**: text area or secondary editor for JSON input payload.
   - **Resource limits**: numeric inputs for CPU count, memory (MB), and timeout (seconds) with sensible defaults.
3. Submit button calls `POST /v1/workloads/async` with the form data.
4. On successful submission, navigate to `/workloads/[id]` (the created workload's detail page).
5. Form validation: runtime is required; show clear error messages for API errors.
6. Graceful handling of unavailable backends — disabled isolation options with messaging (AC8).

## Implementation Plan

1. **External Packages**: This task requires research and a guide document for: code editor library (CodeMirror recommended — lighter weight, better for this use case)
2. Create `web/src/app/workloads/new/page.tsx` — submission form page.
3. Create `web/src/components/form/CodeEditor.tsx` — code editor wrapper component.
4. Create `web/src/components/form/RuntimeSelector.tsx` — runtime dropdown.
5. Create `web/src/components/form/IsolationSelector.tsx` — isolation dropdown with backend availability check.
6. Create `web/src/components/form/ResourceLimits.tsx` — CPU, memory, timeout inputs.
7. Wire form submission to `createWorkload()` from task 3-2's API client.
8. Use `useBackends()` hook to determine which isolation modes are available.
9. Handle loading state during submission, error display on failure.
10. Navigate to `/workloads/[id]` using Next.js router on success.

## Test Plan

### Objectives
Verify the form correctly submits workloads and handles all input variations and error states.

### Test Scope
- Form renders all fields with correct defaults.
- Runtime selector shows all 5 runtime options.
- Isolation selector reflects backend availability (disabled options for unregistered backends).
- Code editor accepts input and supports syntax highlighting.
- Resource limits accept numeric values.
- Successful submission creates workload and navigates to detail.
- Missing runtime shows validation error.
- API error responses display clearly.

### Success Criteria
- All form fields functional and visually correct.
- Submission calls the correct API endpoint with well-formed payload.
- Navigation to detail page works post-submission.

## Verification

- `pnpm build` succeeds with no errors.
- Runtime selector shows all 5 runtime options.
- Isolation selector reflects backend availability (disabled for unregistered backends).
- Code editor renders with syntax highlighting (JS/TS, Python) and per-runtime placeholders.
- Resource limits accept numeric values with sensible defaults (1 CPU, 128MB, 30s).
- Invalid JSON shows error message; API errors display clearly.
- Submit calls correct endpoint; navigates to detail page on success.
- AI review: 0 critical, 0 high, 3 medium (component extraction, magic strings, fetch timeout — deferred), 5 low (deferred).

## Files Modified

- `web/src/components/form/CodeEditor.tsx` — CodeMirror wrapper with runtime-based language extensions
- `web/src/app/workloads/new/page.tsx` — workload submission form page
- `docs/delivery/3/3-6-codemirror-guide.md` — external package research guide
