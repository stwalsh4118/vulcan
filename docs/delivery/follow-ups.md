# Follow-Ups

Ideas, improvements, and deferred work captured during planning and implementation.
Review periodically — good candidates become new PBIs via `/new-pbi`.

## Open

| # | Type | Summary | Source | Date | Notes |
|---|------|---------|--------|------|-------|
| 1 | enhancement | Firecracker jailer integration for production-grade isolation | PBI-4 | 2026-02-19 | Deferred from initial implementation. Config includes `JailerEnabled` flag (default false). Jailer adds chroot, namespaces, seccomp, and per-VM UID isolation. Should be a dedicated task or PBI once basic VM execution is proven. |
| 2 | enhancement | CI-built rootfs images with artifact download | PBI-4 | 2026-02-19 | Current plan builds rootfs locally via Makefile (simpler for dev). For team workflows, rootfs images should be built in CI and downloadable as versioned artifacts to avoid requiring root/mount privileges on every dev machine. |
| 3 | perf | VM warm pool for reduced cold starts | PBI-4 | 2026-02-19 | Firecracker cold starts are ~125ms. A warm pool of pre-booted VMs per runtime could eliminate boot latency entirely for bursty workloads. Trade-off: memory overhead for idle VMs. |
| 4 | perf | Copy-on-write rootfs overlays instead of full copies | PBI-4 | 2026-02-19 | Each VM needs a writable rootfs. Full copy is simple but slow for large images. Device-mapper thin provisioning or overlayfs snapshots would be faster. Revisit after measuring boot time with full copies. |
| 5 | enhancement | Auto-download Firecracker binary and kernel on first run | PBI-4 | 2026-02-19 | Current plan uses pinned versions with manual `make download`. Auto-downloading on first server start (if binaries missing) would improve DX for new contributors. Risk: network dependency at startup. |
| 6 | feature | Multi-file workload editor in frontend | PBI-4 | 2026-02-19 | Archive upload (tar.gz) covers multi-file projects, but a multi-tab code editor in the browser would be a better UX for small projects. Lower priority than archive upload. |
| 7 | enhancement | Firecracker snapshot/restore for instant cold starts | PBI-4 | 2026-02-19 | Firecracker supports VM snapshots. Boot a VM, snapshot it after guest agent is ready, then restore from snapshot instead of booting. Could reduce cold start from ~125ms to <5ms. Significant complexity. |
| 8 | docs | Firecracker host prerequisites guide | PBI-4 | 2026-02-19 | Document KVM setup, nested virtualization config for cloud VMs, required kernel modules, and troubleshooting. Important for contributors who don't have bare-metal Linux. |
| 9 | tech-debt | Extract shared E2E test helpers | PBI-4 | 2026-02-19 | pbi2_test.go, pbi4_test.go, pbi9_test.go all duplicate stubBackend, server setup, postAsync, pollStatus helpers. Extract into shared helpers_test.go. |
| 10 | fix | Sync endpoint should default isolation to "auto" | PBI-4 | 2026-02-19 | POST /v1/workloads (sync) does not default isolation to "auto" when omitted, but the async endpoint does. Pre-existing inconsistency — both should behave the same. |
| 11 | enhancement | Add data-testid attributes to frontend for Playwright robustness | PBI-4 | 2026-02-19 | Playwright tests use positional selectors (select:nth(1), .font-mono:last). Adding data-testid attributes would make tests more resilient to layout changes. |
| 12 | fix | SSE log streaming buffered by Next.js rewrite proxy | PBI-4 | 2026-02-19 | Log lines don't stream in real-time to the browser — they all arrive at once when the workload finishes. Confirmed: `curl -N` directly to `:8080` streams lines one per second correctly. The Next.js `rewrites()` proxy buffers the SSE response. Need to either bypass the proxy for SSE (connect directly to :8080), use a custom Next.js API route with streaming support, or switch to a WebSocket transport. |
| 13 | fix | SSE log connections not cleaned up after workload completion | PBI-4 | 2026-02-19 | After running multiple workloads, many `/logs` SSE requests accumulate and only stop when the page is closed. The `useLogStream` hook's `onerror` reconnect logic fires when the server closes the connection on workload completion, creating reconnect loops before the 2s status poll detects the terminal state. Fix: check terminal status before reconnecting, or have the SSE endpoint send a "done" event instead of closing abruptly. |
| 14 | tech-debt | Centralize backend URL constant across web project | PBI-10 | 2026-02-20 | `http://localhost:8080` is duplicated in `next.config.ts`, `route.ts` (BACKEND_BASE_URL), and Playwright spec files. Should be a shared env var or config constant. |
| 15 | enhancement | Propagate client abort signal to upstream SSE fetch in streaming route | PBI-10 | 2026-02-20 | The Next.js SSE proxy route does not pass `request.signal` to the upstream `fetch()`. If the browser disconnects, the upstream connection is not aborted until the Go backend closes it. Pass `{ signal: request.signal }` for prompt cleanup. |
