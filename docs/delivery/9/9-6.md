# [9-6] E2E CoS Test

[Back to task list](./tasks.md)

## Description

End-to-end tests verifying all PBI 9 Conditions of Satisfaction. Tests cover the full flow from workload execution through log persistence, API retrieval, and frontend display for both active and completed workloads.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 07:13:41 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

Verify all PBI 9 acceptance criteria:

1. **AC1**: Log lines are persisted to SQLite as they are produced during workload execution.
2. **AC2**: `GET /v1/workloads/:id/logs/history` returns all persisted log lines as JSON array.
3. **AC3**: Frontend detail page displays persisted logs for completed/failed/killed workloads.
4. **AC4**: Real-time SSE streaming continues to work for active (pending/running) workloads.
5. **AC5**: The log viewer seamlessly handles the transition from live streaming to historical display when a workload completes.
6. **AC6**: Persisted logs are ordered by sequence number and display in the correct order.

## Implementation Plan

### Backend E2E Tests (Go)
1. **Full lifecycle test**: Submit async workload → wait for completion → call `/logs/history` → verify log lines match expected output with correct ordering.
2. **SSE + persistence**: Submit workload → subscribe to SSE stream → collect lines → after completion, call `/logs/history` → verify SSE lines match persisted lines.
3. **Multiple workloads isolation**: Submit two workloads → verify each workload's history contains only its own log lines.

### Frontend E2E Tests (Playwright)
4. **Historical logs display**: Submit workload via API → wait for completion → navigate to detail page → verify log lines are visible in the LogViewer.
5. **Live streaming still works**: Navigate to detail page of a running workload → verify SSE streaming indicator and log lines appearing in real time.
6. **Live-to-historical transition**: Navigate to detail page of a running workload → wait for it to complete → verify logs remain visible and status indicator changes.

## Test Plan

### Objectives
Comprehensive end-to-end verification of all PBI 9 acceptance criteria.

### Environment & Setup
- Backend running on localhost:8080.
- Frontend running on localhost:3000 (for Playwright tests).
- Clean database state before each test.

### Test Scope

| Test | AC Covered | Type |
|------|-----------|------|
| Log persistence during execution | AC1, AC6 | Backend integration |
| History endpoint returns correct data | AC2, AC6 | Backend integration |
| Frontend shows historical logs | AC3 | Playwright E2E |
| SSE streaming unchanged | AC4 | Backend integration |
| Live-to-historical transition | AC5 | Playwright E2E |
| Cross-workload isolation | AC1 | Backend integration |

### Success Criteria
- All E2E tests pass.
- No regressions in existing test suites.
- All 6 acceptance criteria verified.

## Verification

_To be completed during implementation._

## Files Modified

_To be completed during implementation._
