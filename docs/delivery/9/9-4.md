# [9-4] Historical Logs API Endpoint

[Back to task list](./tasks.md)

## Description

Add a new REST endpoint `GET /v1/workloads/:id/logs/history` that returns all persisted log lines for a workload as a JSON array. Update the API specification document to include the new endpoint.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-19 07:13:41 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements

1. Add handler `handleGetLogHistory` in `api/internal/api/logs.go`.
2. Register route: `GET /v1/workloads/{id}/logs/history` in `server.go`.
3. Handler behavior:
   - Look up workload by ID — return 404 if not found.
   - Call `store.GetLogLines(ctx, id)`.
   - Return JSON response: `{"workload_id": "<id>", "lines": [{"seq": 0, "line": "...", "created_at": "..."}]}`.
   - Return empty `lines` array (not null) if no log lines exist.
4. Response content type: `application/json`.
5. Update `docs/api-specs/core/core-api.md` with the new endpoint specification.

## Implementation Plan

1. Add `handleGetLogHistory` method to `Server` in `api/internal/api/logs.go`:
   - Extract workload ID from URL param.
   - Verify workload exists via `store.GetWorkload`.
   - Fetch log lines via `store.GetLogLines`.
   - Marshal and return JSON response.
2. Register route in `server.go` under the `/v1/workloads` route group: `r.Get("/{id}/logs/history", s.handleGetLogHistory)`.
3. Update `docs/api-specs/core/core-api.md` with the new endpoint documentation.
4. Write unit/integration test verifying:
   - 200 response with log lines for a workload that has persisted logs.
   - 200 response with empty lines array for a workload with no logs.
   - 404 for non-existent workload.

## Test Plan

### Objectives
Verify the historical logs endpoint returns correct JSON responses.

### Key Scenarios
1. **Happy path** — workload exists with persisted logs → 200 with populated `lines` array.
2. **No logs** — workload exists but has no log lines → 200 with empty `lines` array.
3. **Not found** — non-existent workload ID → 404 error.
4. **Ordering** — log lines in response are ordered by sequence number.

### Success Criteria
- All test scenarios pass.
- API spec document is updated.
- `go build ./...` succeeds.

## Verification

_To be completed during implementation._

## Files Modified

_To be completed during implementation._
