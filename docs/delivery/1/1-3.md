# [1-3] Workload Domain Types

[Back to task list](./tasks.md)

## Description

Define the core domain types for workloads: the `Workload` struct, status/isolation/runtime constants, and ULID-based ID generation. These types are used by the store and API layers.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-18 11:12:42 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-18 11:24:51 | Status Change | Proposed | Agreed | User requested PBI implementation | AI_Agent |
| 2026-02-18 11:24:51 | Status Change | Agreed | InProgress | Started implementation | AI_Agent |
| 2026-02-18 11:27:32 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-18 11:58:00 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. `internal/model/workload.go` — `Workload` struct matching the PRD data model:
   - `ID`, `Status`, `Isolation`, `Runtime`, `NodeID`, `InputHash`, `Output`, `ExitCode`, `Error`
   - `CPULimit`, `MemLimit`, `TimeoutS`, `DurationMS`
   - `CreatedAt`, `StartedAt`, `FinishedAt`
2. Status constants: `pending`, `running`, `completed`, `failed`, `killed`.
3. Isolation constants: `microvm`, `isolate`, `gvisor`.
4. Runtime constants: `go`, `node`, `python`, `wasm`, `oci`.
5. `NewID()` function generating ULID strings using `github.com/oklog/ulid/v2`.
6. Types should use appropriate Go types (e.g., `*time.Time` for nullable timestamps, `*int` for nullable integers).

## Implementation Plan

1. Create `internal/model/workload.go` with the Workload struct.
2. Define typed string constants for Status, Isolation, Runtime.
3. Create `internal/model/id.go` with `NewID()` using `oklog/ulid/v2` with `math/rand` entropy source.
4. Run `go get github.com/oklog/ulid/v2`.

**External Packages**: This task requires research and a guide document for: `github.com/oklog/ulid/v2`

## Test Plan

- `NewID()` produces valid ULID strings (26 chars, Crockford base32).
- Successive `NewID()` calls produce unique values.
- All status/isolation/runtime constants are defined and have expected string values.
- Workload struct fields have correct types.

## Verification

- `go build ./cmd/vulcan` succeeds.
- `go vet ./...` passes.
- All 5 model tests pass: ID format, uniqueness, status/isolation/runtime constants.

## Files Modified

- `api/internal/model/workload.go` — Workload struct with all PRD fields
- `api/internal/model/id.go` — NewID() using oklog/ulid
- `api/internal/model/model_test.go` — Unit tests
- `api/go.mod` / `api/go.sum` — Added oklog/ulid/v2 dependency
- `docs/delivery/1/1-3-ulid-guide.md` — External package research guide
