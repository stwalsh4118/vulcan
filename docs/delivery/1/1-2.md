# [1-2] Configuration & Structured Logging

[Back to task list](./tasks.md)

## Description

Create a configuration struct loaded from environment variables and set up structured JSON logging to stdout using `log/slog`. The config must support at minimum: listen address, database path, and log level.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-18 11:12:42 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-18 11:22:24 | Status Change | Proposed | Agreed | User requested PBI implementation | AI_Agent |
| 2026-02-18 11:22:24 | Status Change | Agreed | InProgress | Started implementation | AI_Agent |
| 2026-02-18 11:24:51 | Status Change | InProgress | Review | Implementation complete, internal AI review passed | AI_Agent |
| 2026-02-18 11:58:00 | Status Change | Review | Done | Task completed and verified | AI_Agent |

## Requirements

1. `internal/config/config.go` — `Config` struct with fields:
   - `ListenAddr` (default `:8080`, env `VULCAN_LISTEN_ADDR`)
   - `DBPath` (default `vulcan.db`, env `VULCAN_DB_PATH`)
   - `LogLevel` (default `info`, env `VULCAN_LOG_LEVEL`)
2. `Load()` function reads from env vars with sensible defaults.
3. Structured JSON logger configured via `log/slog` with the configured level.
4. Logger writes to stdout.
5. Update `cmd/vulcan/main.go` to load config and initialize logger on startup.

## Implementation Plan

1. Create `internal/config/config.go` with `Config` struct and `Load()` function.
2. Use `os.Getenv` with fallback defaults for each field.
3. Parse `LogLevel` string into `slog.Level`.
4. Create logger factory function that returns a `*slog.Logger` configured with JSON handler at the specified level.
5. Update `main.go` to call `config.Load()`, init the logger, and log startup info.

## Test Plan

- Default config values are correct when no env vars are set.
- Each env var overrides the corresponding default.
- Invalid log level falls back to `info`.
- Logger output is valid JSON with expected fields (time, level, msg).

## Verification

- `go build ./cmd/vulcan` succeeds.
- `go vet ./...` passes.
- All config tests pass (defaults, env overrides, log level parsing, logger creation).
- Running the binary outputs structured JSON with `listen_addr` and `db_path` fields.

## Files Modified

- `api/internal/config/config.go` — Config struct, Load(), NewLogger()
- `api/internal/config/config_test.go` — Unit tests for config
- `api/cmd/vulcan/main.go` — Updated to load config and init logger
